<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Test</title>
  </head>

  <body>
    <article>
      <!-- TOP ROW -->
      <canvas id="a1" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="a1-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="a1-uploader" type="file" hidden>

      <canvas id="a2" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="a2-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="a2-uploader" type="file" hidden>

      <canvas id="a3" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="a3-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="a3-uploader" type="file" hidden>
      <br>

      <!-- MID ROW -->
      <canvas id="b1" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="b1-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="b1-uploader" type="file" hidden>

      <canvas id="b2" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="b2-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="b2-uploader" type="file" hidden>

      <canvas id="b3" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="b3-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="b3-uploader" type="file" hidden>
      <br>

      <!-- BOT ROW -->
      <canvas id="c1" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="c1-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="c1-uploader" type="file" hidden>

      <canvas id="c2" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="c2-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="c2-uploader" type="file" hidden>

      <canvas id="c3" width="250px" height="250px" style="cursor: pointer"></canvas>
      <img    id="c3-source" src="https://dummyimage.com/250x250/000/fff.png&text=Double-click+to+upload+image" style="display: none">
      <input  id="c3-uploader" type="file" hidden>
    </article>
  </body>

  <script>
    function Cell(id) {
    this.xPos     = 0;
    this.yPos     = 0;
    this.element  = document.getElementById(id);
    this.image    = document.getElementById(id + "-source");
    this.context  = document.getElementById(id).getContext("2d");
    this.uploader = document.getElementById(id + "-uploader");
    this.mouseStatus = {
      xPos : 0,
      yPos : 0,
      isDragging   : false,
      withinCanvas : false
    }

    this.xShift  = function(units) {
      this.xPos += units;
      if(this.xPos > 0) {
        this.xPos = 0;
      }
      let max = (this.image.width - this.element.width) * -1;
      if(this.xPos < max) {
        this.xPos = max;
      }
    };

    this.yShift  = function(units) {
      this.yPos += units;
      if(this.yPos > 0) {
        this.yPos = 0;
      }
      let max = (this.image.height - this.element.height) * -1;
      if(this.yPos < max) {
        this.yPos = max;
      }
    };

    this.render  = function() {
      this.context.drawImage(this.image, this.xPos, this.yPos);
    }
  }

    function picUploader(event) {
      let reader = new FileReader();
      reader.readAsDataURL(event.target.files[0]);
      reader.onload = function(data) {
        document.getElementById(event.target.id.replace("uploader", "source")).src = data.target.result;
      };
    }

    function cellSetup(cell) {
      cell.element.onmouseenter = () => { cell.mouseStatus.withinCanvas = true  };
      cell.element.onmouseleave = () => {
        cell.mouseStatus.withinCanvas = false;
        cell.mouseStatus.isDragging = false;
      };
      cell.element.onmouseup = () => { cell.mouseStatus.isDragging = false };
      cell.element.onmousedown = function(event) {
        cell.mouseStatus.xPos = event.pageX - this.offsetLeft;
        cell.mouseStatus.yPos = event.pageY - this.offsetTop;
        cell.mouseStatus.isDragging = true;
      };
      cell.element.onmousemove = function(event) {
        if(cell.mouseStatus.isDragging) {
          let xPos = event.pageX - this.offsetLeft;
          let yPos = event.pageY - this.offsetTop;
          cell.xShift(xPos - cell.mouseStatus.xPos);
          cell.yShift(yPos - cell.mouseStatus.yPos);
          cell.mouseStatus.yPos = yPos;
          cell.mouseStatus.xPos = xPos;
        }
      }
      cell.element.ondblclick = () => { cell.uploader.click() };
      cell.uploader.addEventListener("change", picUploader);
    }

    let cells = [
      new Cell("a1"), new Cell("a2"), new Cell("a3"),
      new Cell("b1"), new Cell("b2"), new Cell("b3"),
      new Cell("c1"), new Cell("c2"), new Cell("c3")
    ];
    for(let i = 0; i < cells.length; i++) {
      cellSetup(cells[i]);
    }

    setInterval(() => {
      for(let i = 0; i < cells.length; i++) {
        cells[i].render();
      }
    }, 1000/60);
  </script>
</html>
