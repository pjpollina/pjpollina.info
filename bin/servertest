#!/usr/bin/env ruby

require './http_server.rb'
require './blog_controller.rb'

PAGE_NAME = "PJ's Site" # The name of the site

server = HTTPServer.new
controller = BlogController.new
loop do
  server.serve do |socket|
    request = socket.gets   # Gets data sent to socket
    STDERR.puts request     # Prints recieved requests to console

    requested_path = request.split(' ')[1]
    if(requested_path.end_with?(*HTTPServer::MIME_TYPES.keys))
      HTTPServer.file_response(".#{requested_path}", socket)
    else
      socket.print controller.respond(requested_path)
    end
  end
end
